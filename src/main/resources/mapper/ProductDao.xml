<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.yt.dao.ProductDao">
    <insert id="insertProduct" parameterType="com.yt.entity.Product" useGeneratedKeys="true"
            keyProperty="productId" keyColumn="product_id">
        insert into tb_product(product_name, product_desc, img_addr, normal_price,
          promotion_price, priority, create_time, last_edit_time, enable_status,
          product_category_id, shop_id)
        values
          (#{productName}, #{productDesc}, #{imgAddr},
           #{normalPrice}, #{promotionPrice}, #{priority}, #{createTime},
           #{lastEditTime}, #{enableStatus}, #{productCategory.productCategoryId},
           #{shop.shopId}
          )
    </insert>

    <update id="updateProduct" parameterType="com.yt.entity.Product"
            keyProperty="product_id" useGeneratedKeys="true">
        UPDATE tb_product
        <set>
            <if test="productName != null">product_name=#{productName},</if>
            <if test="productDesc != null">product_desc=#{productDesc},</if>
            <if test="imgAddr != null">img_addr=#{imgAddr},</if>
            <if test="normalPrice != null">normal_price=#{normalPrice},</if>
            <if test="promotionPrice != null">promotion_price=#{promotionPrice},</if>
            <if test="priority != null">priority=#{priority},</if>
            <if test="lastEditTime != null">last_edit_time=#{lastEditTime},</if>
            <if test="enableStatus != null">enable_status=#{enableStatus},</if>
            <if test="point != null">point=#{point},</if>
            <if test="productCategory != null
				 and productCategory.productCategoryId != null">
                product_category_id=#{productCategory.productCategoryId}
            </if>
        </set>
        WHERE product_id = #{productId}
        AND shop_id=#{shop.shopId}
    </update>
    <update id="updateProductCategoryToNull" parameterType="Long"
            keyProperty="product_id" useGeneratedKeys="true">
		UPDATE tb_product
		SET
		product_category_id = null
		WHERE product_category_id =
		#{productCategoryId}
	</update>
</mapper>